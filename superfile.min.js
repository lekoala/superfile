const BASE_CLASS="superfile",PREVIEW_CLASS="superfile-preview",CLEAR_CLASS="superfile-clear",MAX_WIDTH=1024,MAX_HEIGHT=1024;class Superfile{constructor(e){this.inputElement=e,this.parentElement=e.parentElement,this.parentElement.classList.contains(BASE_CLASS)||(this.parentElement=this.parentElement.parentElement),this.previewElement=this.parentElement.querySelector("img."+PREVIEW_CLASS),this.clearElement=this.parentElement.querySelector("."+CLEAR_CLASS),this.disableResize=!!e.dataset.disableResize,this.maxWidth=e.dataset.maxWidth?parseInt(e.dataset.maxWidth):MAX_WIDTH,this.maxHeight=e.dataset.maxHeight?parseInt(e.dataset.maxHeight):MAX_HEIGHT,this.inputElement.addEventListener("change",e=>{this.processImage(()=>{this.showPreview()})}),this.clearElement&&this.clearElement.addEventListener("click",e=>{this.clearPreview()})}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++){let i=t[e];new Superfile(i)}}showPreview(){this.previewElement&&(this.previewElement.src=URL.createObjectURL(this.inputElement.files[0]))}clearPreview(){this.inputElement.value=null,this.previewElement&&(this.previewElement.src="")}resizeImage(e,t,i){let s=document.createElement("canvas"),a=t.width,l=t.height;if(a<=this.maxWidth&&l<=this.maxHeight)return void i();a>this.maxWidth&&(l*=this.maxWidth/a,a=this.maxWidth),l>this.maxHeight&&(a*=this.maxHeight/l,l=this.maxHeight),a=Math.round(a),l=Math.round(l),s.width=a,s.height=l;let n=s.getContext("2d");n.drawImage(t,0,0,a,l),n.canvas.toBlob(t=>{this.createProcessedFile(e,t,i)},e.type,1)}handleResizeImage(e,t){if(!e.type.match(/image.*/))return void t();if(this.disableResize)return void t();let i=new FileReader;i.onload=(i=>{let s=new Image;s.onload=(()=>{this.resizeImage(e,s,t)}),s.onerror=(e=>{console.log(e)}),s.src=i.target.result}),i.onerror=(e=>{console.log(e)}),i.readAsDataURL(e)}createProcessedFile(e,t,i){let s=new File([t],e.name,{type:e.type,lastModified:Date.now()}),a=new DataTransfer;a.items.add(s),this.inputElement.files=a.files,i()}processImage(e){let t=this.inputElement.files[0];t?this.handleResizeImage(t,e):e()}}export default Superfile;