const BASE_CLASS="superfile",PREVIEW_CLASS="superfile-preview",CLEAR_CLASS="superfile-clear",MAX_WIDTH=1024,MAX_HEIGHT=1024;class Superfile{constructor(e){this.inputElement=e,this.parentElement=e.parentElement,this.parentElement.classList.contains(BASE_CLASS)||(this.parentElement=this.parentElement.parentElement),this.previewElement=this.parentElement.querySelector("img."+PREVIEW_CLASS),this.clearElement=this.parentElement.querySelector("."+CLEAR_CLASS),this.disableResize=!!e.dataset.disableResize,this.maxWidth=e.dataset.maxWidth?parseInt(e.dataset.maxWidth):MAX_WIDTH,this.maxHeight=e.dataset.maxHeight?parseInt(e.dataset.maxHeight):MAX_HEIGHT,this.hideClear=!!e.dataset.hideClear,this.imageRatio=e.dataset.ratio?e.dataset.ratio.split(/\/|:/):null,this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",e=>{this.processImage(()=>{this.showPreview()})}),this.clearElement&&this.clearElement.addEventListener("click",e=>{this.clearPreview()}),this.parentElement.classList.add("superfile-ready")}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let e=0;e<t.length;e++){let i=t[e];new Superfile(i)}}showPreview(){this.previewElement&&(this.parentElement.classList.add("superfile-preview-active"),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay),this.inputElement.files[0]&&(this.previewElement.src=URL.createObjectURL(this.inputElement.files[0])))}clearPreview(){this.inputElement.value=null,this.previewElement&&(this.parentElement.classList.remove("superfile-preview-active"),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none"))}resizeImage(e,t,i){let a=document.createElement("canvas"),s=0,l=0,r=t.naturalWidth,n=t.naturalHeight,h=r,m=n,d=r,o=n,p=d>this.maxWidth||o>this.maxHeight,c=d/o,E=c,g=!1;if(this.imageRatio&&(E=this.imageRatio[0]/this.imageRatio[1],g=this.imageRatio!==E),!p&&!g)return void i();g&&(c>E?d=o*E:c<E&&(o=d/E),s=(r-d)/2,l=(n-o)/2),d>this.maxWidth&&(o*=this.maxWidth/d,h*=this.maxWidth/d,m*=this.maxWidth/d,d=this.maxWidth),o>this.maxHeight&&(d*=this.maxHeight/o,h*=this.maxHeight/o,m*=this.maxHeight/o,o=this.maxHeight),d=Math.round(d),o=Math.round(o),a.width=d,a.height=o;let u=a.getContext("2d");u.imageSmoothingEnabled=!0,u.imageSmoothingQuality="high",g?u.drawImage(t,s,l,r,n,0,0,h,m):u.drawImage(t,0,0,d,o),u.canvas.toBlob(t=>{this.createProcessedFile(e,t,i)},e.type,1)}handleResizeImage(e,t){if(!e.type.match(/image.*/))return void t();if(this.disableResize)return void t();let i=new FileReader;i.onload=(i=>{let a=new Image;a.onload=(()=>{this.resizeImage(e,a,t)}),a.onerror=(e=>{}),a.src=i.target.result}),i.onerror=(e=>{console.log(e)}),i.readAsDataURL(e)}createProcessedFile(e,t,i){let a=new File([t],e.name,{type:e.type,lastModified:Date.now()}),s=new DataTransfer;s.items.add(a),this.inputElement.files=s.files,i()}processImage(e){let t=this.inputElement.files[0];t?this.handleResizeImage(t,e):e()}}export default Superfile;