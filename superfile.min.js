var R="superfile",u="superfile-preview",w="superfile-preview-active",S="superfile-clear",D="superfile-ready",E="superfile-drag",y="superfile-clone";var v=class L{constructor(e){this.inputElement=e,this.holderElement=e.parentElement,this.holderElement.classList.contains(R)||(this.holderElement=this.holderElement.parentElement),this.previewElement=this.holderElement.querySelector("img."+u),this.clearElement=this.holderElement.querySelector("."+S),this.disableResize=!!e.dataset.disableResize,this.maxWidth=e.dataset.maxWidth?parseInt(e.dataset.maxWidth):1024,this.maxHeight=e.dataset.maxHeight?parseInt(e.dataset.maxHeight):1024,this.hideClear=!!e.dataset.hideClear,this.imageRatio=e.dataset.ratio?e.dataset.ratio.split(/\/|:/):null,this.clearElement&&this.hideClear&&(this.clearElement.dataset.originalDisplay=this.clearElement.style.display?this.clearElement.style.display:"block",this.clearElement.style.display="none"),this.previewElement&&this.previewElement.getAttribute("src")&&this.showPreview(),this.inputElement.addEventListener("change",t=>{this.processFiles(()=>{this.showPreview()})}),this.clearElement&&this.clearElement.addEventListener("click",t=>{this.clearPreview()}),this.holderElement.addEventListener("dragleave",t=>{this.onDragleave(t)}),this.holderElement.addEventListener("dragover",t=>{this.onDragover(t)}),this.holderElement.addEventListener("drop",t=>{this.onDrop(t)}),this.holderElement.classList.add(D)}static init(e="input[type=file]"){let t=document.querySelectorAll(e);for(let i=0;i<t.length;i++){let s=t[i],r=new L(s)}}onDrop(e){e.stopPropagation(),e.preventDefault(),this.inputElement.files=e.dataTransfer.files,this.inputElement.dispatchEvent(new Event("change")),this.holderElement.classList.remove(E)}onDragover(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.contains(E)||this.holderElement.classList.add(E),e.dataTransfer.dropEffect="copy"}onDragleave(e){e.stopPropagation(),e.preventDefault(),this.holderElement.classList.remove(E)}showPreview(){if(!this.previewElement)return;this.holderElement.classList.add(w),this.clearElement&&this.clearElement.dataset.originalDisplay&&(this.clearElement.style.display=this.clearElement.dataset.originalDisplay);let e=this.previewElement.parentElement;for(let t=0;t<this.inputElement.files.length;t++){let i=this.inputElement.files[t];if(!i.type.match(/image.*/))continue;let s=e.querySelectorAll("."+u)[t];s||(s=this.previewElement.cloneNode(!0),s.classList.add(y),e.appendChild(s)),s.src=URL.createObjectURL(i)}}clearPreview(){if(this.previewElement){this.holderElement.classList.remove(w),this.previewElement.removeAttribute("src"),this.hideClear&&(this.clearElement.style.display="none");let e=this.holderElement.querySelectorAll("."+y);for(let t=0;t<e.length;t++)e[t].parentElement.removeChild(e[t])}this.inputElement.value=null}resizeImage(e,t,i){let s=document.createElement("canvas"),r=0,n=0,h=t.naturalWidth,m=t.naturalHeight,p=h,g=m,l=h,a=m,x=l>this.maxWidth||a>this.maxHeight,f=l/a,o=f,c=!1;if(this.imageRatio&&(o=this.imageRatio[0]/this.imageRatio[1],c=this.imageRatio!==o),!x&&!c){i();return}c&&(f>o?l=a*o:f<o&&(a=l/o),r=(h-l)/2,n=(m-a)/2),l>this.maxWidth&&(a*=this.maxWidth/l,p*=this.maxWidth/l,g*=this.maxWidth/l,l=this.maxWidth),a>this.maxHeight&&(l*=this.maxHeight/a,p*=this.maxHeight/a,g*=this.maxHeight/a,a=this.maxHeight),l=Math.round(l),a=Math.round(a),s.width=l,s.height=a;let d=s.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",c?d.drawImage(t,r,n,h,m,0,0,p,g):d.drawImage(t,0,0,l,a),d.canvas.toBlob(A=>{this.createProcessedFile(e,A,i)},e.type,1)}handleResizeImage(e,t){if(!e.type.match(/image.*/)){t();return}if(this.disableResize){t();return}let i=new FileReader;i.onload=s=>{let r=new Image;r.onload=()=>{this.resizeImage(e,r,t)},r.onerror=n=>{},r.src=s.target.result},i.onerror=s=>{console.log(s)},i.readAsDataURL(e)}createProcessedFile(e,t,i){let s=new File([t],e.name,{type:e.type,lastModified:Date.now()}),r=new DataTransfer;for(let n=0;n<this.inputElement.files.length;n++){let h=this.inputElement.files[n];h.name===e.name?r.items.add(s):r.items.add(h)}this.inputElement.files=r.files,i()}processFiles(e){let t=this.inputElement.files;if(!t.length){e();return}for(let i=0;i<t.length;i++)this.handleResizeImage(t[i],e)}},H=v;export{H as default};
